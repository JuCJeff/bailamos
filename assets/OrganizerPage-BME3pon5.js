import{u as C,j as e,r as n}from"./index-BsdhmCxN.js";import{s as O,a as v,b,o as z,d as y,c as E,g as U,u as M,t as m,T as B,C as L,e as D,f as F,h as T,i as _,j as A,k as H,l as I,m as N,n as k}from"./index-COnCqZNY.js";import{B as w,I as R,c as W,H as V}from"./HeadBar-CUMT4-EZ.js";const q=()=>{const s=C();return{handleSignOut:async()=>{try{const t=await O(v);console.log(t),b.remove("auth_token"),s("/login")}catch(t){console.error("Error during sign out: ",t)}}}},G=()=>{const{handleSignOut:s}=q();return e.jsx(w,{onClick:s,children:"Log out"})},J=()=>{const[s,a]=n.useState(!0),[t,r]=n.useState(null),[f,c]=n.useState(null);return n.useEffect(()=>{if(b.get("auth_token")){const h=z(v,async g=>{if(g){const u=y(E,"organizers",g.uid),o=await U(u);o.exists()?c(o.data()):r("No organizer data found")}else r("User not authenticated");a(!1)});return()=>h()}else a(!1),r("No authentication token found. Please log in")},[]),{loading:s,error:t,profileData:f}},K=()=>{const[s,a]=n.useState(!1),[t,r]=n.useState(null),[f,c]=n.useState(!1);return{loading:s,error:t,success:f,updateProfile:async h=>{var u;if(a(!0),r(null),c(!1),b.get("auth_token"))try{await((u=v.currentUser)==null?void 0:u.getIdToken(!0));const o=v.currentUser;if(o){const P=y(E,"organizers",o.uid);await M(P,h),c(!0)}else r("User not authenticated")}catch(o){console.error("Error updating profile:",o),r("Failed to update profile. Please try again.")}finally{a(!1)}else a(!1),r("No authentication token found. Please log in again.")}}},Q=()=>{const[s,a]=n.useState(!0),[t,r]=n.useState([]),{loading:f,error:c,profileData:l}=J(),{loading:h,error:g,success:u,updateProfile:o}=K();n.useEffect(()=>{l&&r([{label:"Email",value:l.email},{label:"First name",value:l.firstName||""},{label:"Last name",value:l.lastName||""},{label:"Social Media",value:l.socialMediaLink??""},{label:"Website",value:l.websiteLink??""}])},[l]);const P=async()=>{if(!l){m.error("Profile data not found");return}const d={"First name":"firstName","Last name":"lastName","Social Media":"socialMediaLink",Website:"websiteLink"},p=t.reduce((i,x)=>{const j=d[x.label];return j&&x.value&&(j==="createdAt"?i[j]=A.fromDate(new Date(x.value)):i[j]=x.value),i},{});if(!Object.keys(p).some(i=>p[i]!==l[i])){m("No changes detected. Profile not updated");return}await o(p),u&&m.success("Successfully updated your profile"),g&&m.error("An error occured while updating profile, please try again"),a(!0)};if(f)return e.jsx("div",{children:e.jsx("p",{children:"Profile loading..."})});if(c){m.error(c);return}return e.jsxs("div",{className:"flex flex-col items-center mt-4",children:[e.jsx(B,{richColors:!0,position:"top-center",className:"text-start"}),e.jsx("div",{children:e.jsxs(L,{className:"md:w-[450px]",children:[e.jsx(D,{children:e.jsx(F,{children:"Profile"})}),e.jsx(T,{children:e.jsx("ul",{className:"flex-col mt-4",children:t.map((d,p)=>e.jsxs("li",{className:"flex gap-1 items-center text-start mb-2 justify-between",children:[e.jsx("label",{className:"w-1/4",children:d.label}),e.jsx(R,{value:d.value,onChange:S=>{const i=[...t];i[p].value=S.target.value,r(i)},disabled:d.label==="Email"||s,className:"w-3/4"})]},d.label))})}),e.jsxs(_,{className:"flex justify-between",children:[e.jsx(w,{variant:"link",onClick:()=>{a(!s)},disabled:!s,children:"Edit Profile"}),e.jsx(w,{onClick:P,disabled:h||s,variant:s?"outline":"default",children:"Update Profile"})]})]})})]})},X=({className:s,...a})=>e.jsx("div",{className:W("flex flex-col gap-6 m-2",s),...a,children:e.jsxs(L,{className:"min-h-svh",children:[e.jsx(D,{children:e.jsx(F,{className:"text-2xl",children:"Organizer Dashboard"})}),e.jsx(T,{children:e.jsx("div",{className:"flex min-h-full w-full items-center justify-center p-2 max-sm:p-0",children:e.jsx("div",{className:"w-full max-w-sm justify-center",children:e.jsxs(H,{defaultValue:"create-post",className:"w-full",children:[e.jsxs(I,{className:"grid w-full grid-cols-3",children:[e.jsx(N,{value:"create-post",children:"Create Post"}),e.jsx(N,{value:"post",children:"Posts"}),e.jsx(N,{value:"profile",children:"Profile"})]}),e.jsx(k,{value:"create-post",children:"Create an event here"}),e.jsx(k,{value:"post",children:"Previous posts"}),e.jsx(k,{value:"profile",children:e.jsx(Q,{})})]})})})})]})});function ee(){const s=C();return n.useEffect(()=>{const a=b.get("auth_token");console.log(a),a?a===void 0&&s("/"):s("/login")},[s]),e.jsxs("div",{children:[e.jsx(V,{}),e.jsx(X,{}),e.jsx(G,{})]})}export{ee as default};
