import{u as ue,j as e,F as je,r as h,S as ve,C as W,d as Z,e as be,D as ye,f as we,g as Ne,h as Ce,i as Se,P as ke,k as Pe,l as Fe,V as Ee,m as Le,n as Te,o as De,p as ze,q as U,s as Me,I as _e,t as Ie,v as Ue,w as Oe,x as Re,y as k,T as Ve}from"./react-GXTH3AUW.js";import{U as A,E as Ae,y as $e,V as p}from"./vendor-BDfBbFA7.js";import{B as v,c as j,L as He,b as ie,S as Be,a as qe,d as We,e as Ke,f as R,D as K,g as G,h as J,i as Y,j as Q,k as me,l as Ge,C as ee,m as te,n as se,o as ae,p as Je,q as Ye,H as Qe}from"./card-CMZodUuv.js";import{s as Xe,o as Ze,e as L,f as re,u as et,r as tt,h as st,j as at,d as he,k as rt,l as V,m as nt,q as ot,n as it,c as lt,p as le}from"./firebase-nofmxHfp.js";import{a as z,d as P,s as ct}from"./index-DdTYszON.js";import{I as M,T as dt,a as ut,b as H,c as B}from"./input-CtR6lZbr.js";import{E as xe,e as mt,m as ht,a as I}from"./EventCard-Dd5RpeOC.js";import{u as xt,A as ft,G as gt,M as pt,I as jt}from"./google-maps-CgU1mIza.js";import"./shadcn-ui-BA32w1ww.js";const vt=()=>{const s=ue();return{handleSignOut:async()=>{try{const t=await Xe(z);console.log(t),A.remove("auth_token"),s("/login")}catch(t){console.error("Error during sign out: ",t)}}}},bt=()=>{const{handleSignOut:s}=vt();return e.jsx(v,{onClick:s,children:"Log out"})},yt=je,fe=h.createContext({}),O=({...s})=>e.jsx(fe.Provider,{value:{name:s.name},children:e.jsx(W,{...s})}),ne=()=>{const s=h.useContext(fe),a=h.useContext(ge),{getFieldState:t}=Z(),c=be({name:s.name}),i=t(s.name,c);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:n}=a;return{id:n,name:s.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...i}},ge=h.createContext({});function S({className:s,...a}){const t=h.useId();return e.jsx(ge.Provider,{value:{id:t},children:e.jsx("div",{"data-slot":"form-item",className:j("grid gap-2",s),...a})})}function w({className:s,...a}){const{error:t,formItemId:c}=ne();return e.jsx(He,{"data-slot":"form-label","data-error":!!t,className:j("data-[error=true]:text-destructive",s),htmlFor:c,...a})}function T({...s}){const{error:a,formItemId:t,formDescriptionId:c,formMessageId:i}=ne();return e.jsx(ve,{"data-slot":"form-control",id:t,"aria-describedby":a?`${c} ${i}`:`${c}`,"aria-invalid":!!a,...s})}function F({className:s,...a}){const{error:t,formMessageId:c}=ne(),i=t?String((t==null?void 0:t.message)??""):a.children;return i?e.jsx("p",{"data-slot":"form-message",id:c,className:j("text-destructive text-sm",s),...a,children:i}):null}function wt({className:s,classNames:a,showOutsideDays:t=!0,...c}){return e.jsx(ye,{showOutsideDays:t,className:j("p-3",s),classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:j(ie({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:j("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",c.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:j(ie({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({className:i,...n})=>e.jsx(Ne,{className:j("size-4",i),...n}),IconRight:({className:i,...n})=>e.jsx(we,{className:j("size-4",i),...n})},...c})}function Nt({...s}){return e.jsx(Ce,{"data-slot":"popover",...s})}function Ct({...s}){return e.jsx(Se,{"data-slot":"popover-trigger",...s})}function St({className:s,align:a="center",sideOffset:t=4,...c}){return e.jsx(ke,{children:e.jsx(Pe,{"data-slot":"popover-content",align:a,sideOffset:t,className:j("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",s),...c})})}function q({className:s,children:a,...t}){return e.jsxs(Fe,{"data-slot":"scroll-area",className:j("relative",s),...t,children:[e.jsx(Ee,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),e.jsx(X,{}),e.jsx(Le,{})]})}function X({className:s,orientation:a="vertical",...t}){return e.jsx(Te,{"data-slot":"scroll-area-scrollbar",orientation:a,className:j("flex touch-none p-px transition-colors select-none",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...t,children:e.jsx(De,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const ce=({form:s,label:a,formFieldName:t})=>{function c(o){o&&s.setValue(t,o)}function i(o){const r=$e(new Date,parseInt(o)),l=s.getValues(t);l?r.setHours(l.getHours(),l.getMinutes(),l.getSeconds()):r.setHours(0,0,0,0),s.setValue(t,r)}function n(o,r){const l=s.getValues(t)||new Date,f=new Date(l);if(o==="hour"){const d=parseInt(r,10);f.getHours()>=12?f.setHours(d+12):f.setHours(d%12)}else if(o==="minute")f.setMinutes(parseInt(r,10));else if(o==="ampm"){const d=f.getHours();r==="AM"&&d>=12?f.setHours(d-12):r==="PM"&&d<12&&f.setHours(d+12)}s.setValue(t,f)}return e.jsx(O,{control:s.control,name:t,render:({field:o})=>e.jsxs(S,{className:"flex flex-col text-start",children:[e.jsx(w,{children:a}),e.jsxs(Nt,{children:[e.jsx(Ct,{asChild:!0,children:e.jsx(T,{children:e.jsxs(v,{variant:"outline",className:j("w-full pl-3 text-left font-normal",!o.value&&"text-muted-foreground"),children:[o.value?Ae(o.value,"MM/dd/yyyy hh:mm aa"):e.jsx("span",{children:"Select date and time"}),e.jsx(ze,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(St,{className:"w-auto p-2",children:e.jsxs("div",{className:"flex-col sm:flex",children:[e.jsx("div",{children:e.jsxs(Be,{onValueChange:i,children:[e.jsx(qe,{children:e.jsx(We,{placeholder:"Select"})}),e.jsxs(Ke,{position:"popper",children:[e.jsx(R,{value:"0",children:"Today"}),e.jsx(R,{value:"1",children:"Tomorrow"}),e.jsx(R,{value:"3",children:"In 3 days"}),e.jsx(R,{value:"7",children:"In a week"})]})]})}),e.jsxs("div",{className:"sm:flex",children:[e.jsx(wt,{mode:"single",selected:o.value,onSelect:c,initialFocus:!0}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:h-[300px] divide-y sm:divide-y-0 sm:divide-x",children:[e.jsxs(q,{className:"w-64 sm:w-auto",children:[e.jsx("div",{className:"flex sm:flex-col p-2",children:Array.from({length:12},(r,l)=>l+1).reverse().map(r=>e.jsx(v,{size:"icon",variant:o.value&&o.value.getHours()%12===r%12?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("hour",r.toString()),children:r},r))}),e.jsx(X,{orientation:"horizontal",className:"sm:hidden"})]}),e.jsxs(q,{className:"w-64 sm:w-auto",children:[e.jsx("div",{className:"flex sm:flex-col p-2",children:Array.from({length:12},(r,l)=>l*5).map(r=>e.jsx(v,{size:"icon",variant:o.value&&o.value.getMinutes()===r?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("minute",r.toString()),children:r.toString().padStart(2,"0")},r))}),e.jsx(X,{orientation:"horizontal",className:"sm:hidden"})]}),e.jsx(q,{className:"",children:e.jsx("div",{className:"flex sm:flex-col p-2",children:["AM","PM"].map(r=>e.jsx(v,{size:"icon",variant:o.value&&(r==="AM"&&o.value.getHours()<12||r==="PM"&&o.value.getHours()>=12)?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("ampm",r),children:r},r))})})]})]})]})})]}),e.jsx(F,{})]})})};function kt({className:s,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:j("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}const Pt=({control:s,name:a})=>{const{field:t,fieldState:{error:c}}=U({name:a,control:s}),[i,n]=h.useState(t.value??""),o=()=>{t.onChange(i),t.onBlur()};return e.jsxs(S,{children:[e.jsx(w,{children:"Description"}),e.jsx(T,{children:e.jsx(kt,{value:i,onChange:r=>n(r.target.value),onBlur:o,placeholder:"Describe your event..."})}),e.jsx(F,{children:c==null?void 0:c.message})]})},Ft=()=>{const[s,a]=h.useState(!0),[t,c]=h.useState(null),[i,n]=h.useState(null);return h.useEffect(()=>{if(A.get("auth_token")){const r=Ze(z,async l=>{if(l){const f=L(P,"organizers",l.uid),d=await re(f);d.exists()?n(d.data()):c("No organizer data found")}else c("User not authenticated");a(!1)});return()=>r()}else a(!1),c("No authentication token found. Please log in")},[]),{loading:s,error:t,profileData:i}},pe=()=>{const[s,a]=h.useState(null),[t,c]=h.useState(null),[i,n]=h.useState(!0);return h.useEffect(()=>{(async()=>{const r=z.currentUser;if(!r){n(!1);return}try{const l=L(P,"organizers",r.uid),f=await re(l);if(f.exists()){const d=f.data();a((d==null?void 0:d.socialMediaLink)??null),c((d==null?void 0:d.websiteLink)??null)}}catch(l){console.warn("Could not fetch organizer social link:",l)}finally{n(!1)}})()},[]),{socialLink:s,websiteLink:t,loading:i}},Et=()=>{const[s,a]=h.useState(!1),[t,c]=h.useState(null),[i,n]=h.useState(!1);return{loading:s,error:t,success:i,updateProfile:async r=>{var f;if(a(!0),c(null),n(!1),A.get("auth_token"))try{await((f=z.currentUser)==null?void 0:f.getIdToken(!0));const d=z.currentUser;if(d){const m=L(P,"organizers",d.uid);await et(m,r),n(!0)}else c("User not authenticated")}catch(d){console.error("Error updating profile:",d),c("Failed to update profile. Please try again.")}finally{a(!1)}else a(!1),c("No authentication token found. Please log in again.")}}},Lt=({form:s,formValues:a,onSubmit:t,loading:c})=>{const[i,n]=h.useState(!1),{socialLink:o}=pe();return e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsxs(K,{children:[e.jsx(G,{asChild:!0,children:e.jsx(v,{type:"button",variant:"outline",disabled:!s.formState.isValid,children:"Preview Event"})}),e.jsxs(J,{children:[e.jsx(Y,{children:e.jsx(Q,{children:"Preview Event"})}),e.jsx("div",{className:"text-center overflow-y-auto max-h-[75vh]",children:e.jsx(xe,{social:{id:"preview",...a,imageUrl:a.image instanceof File?URL.createObjectURL(a.image):"",createdAt:new Date,organizerSocialLink:o??""}})})]})]}),e.jsxs(K,{open:i,onOpenChange:n,children:[e.jsx(G,{asChild:!0,children:e.jsx(v,{type:"button",disabled:c||!s.formState.isValid,onClick:()=>n(!0),children:c?"Submitting...":"Post Event"})}),e.jsxs(J,{children:[e.jsx(Y,{children:e.jsx(Q,{children:"Confirm Event Submission"})}),e.jsx("p",{children:"Are you sure you want to post this event? Please double-check your details 💃"}),e.jsxs(me,{children:[e.jsx(Ge,{asChild:!0,children:e.jsx(v,{variant:"outline",children:"Cancel"})}),e.jsx(v,{onClick:s.handleSubmit(r=>{n(!1),t(r)}),disabled:c||!s.formState.isValid,children:"Yes, Post It"})]})]})]})]})};function oe({className:s,...a}){return e.jsx(Me,{"data-slot":"checkbox",className:j("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(_e,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Ie,{className:"size-3.5"})})})}const Tt=({control:s,name:a})=>{const{field:{value:t,onChange:c}}=U({name:a,control:s}),i=(n,o)=>{const r=n?[...t||[],o]:(t||[]).filter(l=>l!==o);c(r)};return e.jsxs(S,{className:"space-y-2",children:[e.jsx(w,{children:"Event Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-sm:flex-col",children:mt.map(n=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{id:n,checked:t==null?void 0:t.includes(n),onCheckedChange:o=>i(!!o,n)}),e.jsx(w,{htmlFor:n,className:"text-sm font-normal",children:n})]},n))}),e.jsx(F,{})]})},Dt=["places","marker"],_={lat:43.0722,lng:-89.4008},zt=({control:s,name:a})=>{const[t,c]=h.useState(null),[i,n]=h.useState(!1),[o,r]=h.useState(_),l=h.useRef(null),{isLoaded:f}=xt({googleMapsApiKey:"AIzaSyBuImOK6KWeeg3f71cgw6R-ssJj4arkAjk",libraries:Dt}),d=m=>{var N,D,y,C,E;if(!l.current)return;const u=l.current.getPlace();if(!((N=u.geometry)!=null&&N.location))return;const g=u.geometry.location.lat(),x=u.geometry.location.lng(),b={propertyName:u.name??"",address:u.formatted_address??"",city:(y=(D=u.address_components)==null?void 0:D.find($=>$.types.includes("locality")))==null?void 0:y.long_name,state:(E=(C=u.address_components)==null?void 0:C.find($=>$.types.includes("administrative_area_level_1")))==null?void 0:E.short_name,googleMapsUrl:u.url??`https://www.google.com/maps/search/?api=1&query=${g},${x}`,lat:g,lng:x};c(b),r({lat:g,lng:x}),m(b)};return f?e.jsx(O,{control:s,name:a,render:({field:m})=>e.jsxs(S,{children:[e.jsx(w,{htmlFor:a,children:"Event Location"}),e.jsx(T,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ft,{onLoad:u=>l.current=u,onPlaceChanged:()=>d(m.onChange),children:e.jsx(M,{id:"location",placeholder:"Search for a location...",className:"w-full"})}),e.jsx("div",{className:"w-full h-72 rounded-md border",children:e.jsxs(gt,{center:o,zoom:15,mapContainerClassName:"w-full h-full rounded-2xl",options:ht,children:[t&&e.jsx(pt,{position:{lat:o.lat??_.lat,lng:o.lng??_.lng},onClick:()=>n(!0)}),t&&i&&e.jsx(jt,{position:{lat:o.lat??_.lat,lng:o.lng??_.lng},onCloseClick:()=>n(!1),children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"font-semibold text-md text-primary",children:t.propertyName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.address}),t.city&&t.state&&e.jsxs("p",{className:"text-sm text-gray-400",children:[t.city,", ",t.state]}),e.jsx("a",{href:t.googleMapsUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary underline text-sm",children:"View on Google Maps"})]})})]})})]})}),e.jsx(F,{})]})}):e.jsx("p",{children:"Loading map..."})},Mt=({control:s,name:a})=>e.jsx(O,{control:s,name:a,render:({field:t})=>e.jsxs(S,{children:[e.jsx(w,{htmlFor:"imageUpload",children:"Upload Image"}),e.jsx(T,{children:e.jsx(_t,{id:"imageUpload",value:t.value||void 0,onChange:t.onChange})}),e.jsx(F,{})]})}),_t=({id:s,value:a,onChange:t})=>{const[c,i]=h.useState(null),n=h.useRef(null);h.useEffect(()=>{let r=null;return a instanceof File?(r=URL.createObjectURL(a),i(r)):i(null),()=>{r&&URL.revokeObjectURL(r)}},[a]);const o=r=>{var f;const l=(f=r[0])==null?void 0:f.file;l instanceof File?t(l):(console.warn("Selected image is not a valid File object"),t(void 0))};return e.jsx(Ue,{multiple:!1,value:a?[{file:a,data_url:c??""}]:[],onChange:o,dataURLKey:"data_url",children:({onImageUpload:r,onImageUpdate:l,onImageRemove:f,isDragging:d,dragProps:m})=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{id:s,type:"file",ref:n,className:"hidden",onChange:u=>{var x;const g=(x=u.target.files)==null?void 0:x[0];g instanceof File&&t(g)}}),e.jsx(v,{type:"button",style:d?{backgroundColor:"limegreen",transition:"0.25s"}:void 0,onClick:r,...m,children:"Click or Drop image here"}),c&&e.jsxs("div",{children:[e.jsx("img",{src:c,alt:"event preview",className:"rounded-2xl"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(v,{type:"button",onClick:()=>l(0),children:"Update"}),e.jsx(v,{type:"button",onClick:()=>f(0),children:"Remove"})]})]})]})})},It=({control:s,name:a})=>e.jsx(O,{control:s,name:a,render:({field:t})=>e.jsxs(S,{children:[e.jsx(w,{children:"Link"}),e.jsx(T,{children:e.jsx(M,{placeholder:"event link (optional)","aria-label":"link for additional details",...t})}),e.jsx(F,{})]})}),Ut=()=>{const{control:s,watch:a,setValue:t,trigger:c}=Z(),i=a("music",["bachata","salsa"]),n=a("musicPercentages",{}),[o,r]=h.useState({}),[l,f]=h.useState(!1),d=h.useCallback(()=>{const m=Object.entries(n).filter(([g])=>g!=="others").reduce((g,[,x])=>g+((x==null?void 0:x.percentage)??0),0),u=Math.max(100-m,0);u>0?(t("musicPercentages.others",{name:"Others",percentage:u}),i.includes("others")||t("music",[...i,"others"])):(t("musicPercentages.others",{name:"Others",percentage:0}),i.includes("others")&&t("music",i.filter(g=>g!=="others"))),c("musicPercentages")},[n,i,t,c]);return h.useEffect(()=>{l||(i.forEach(m=>{var u;n[m]||t(`musicPercentages.${m}`,{name:((u=I.find(g=>g.id===m))==null?void 0:u.label)??m,percentage:m==="bachata"||m==="salsa"?50:0}),r(g=>({...g,[m]:`${m==="bachata"||m==="salsa"?50:0}`}))}),f(!0))},[i,n,t,l]),h.useEffect(()=>{Object.keys(n).filter(u=>u!=="others"&&!i.includes(u)).forEach(u=>{var g;t(`musicPercentages.${u}`,{name:((g=I.find(x=>x.id===u))==null?void 0:g.label)??u,percentage:0}),r(x=>({...x,[u]:"0"}))})},[i,n,t]),h.useEffect(()=>{d()},[n,d]),e.jsxs(S,{className:"space-y-2",children:[e.jsx(w,{children:"Music Breakdown"}),i.length===0?e.jsx("p",{className:"text-start text-sm text-gray-500",children:"No music categories selected"}):i.map(m=>{const u=I.find(g=>g.id===m);return u&&e.jsx(W,{control:s,name:`musicPercentages.${m}.percentage`,render:({field:g})=>e.jsxs(S,{className:"flex items-center justify-between gap-2",children:[e.jsx(w,{className:"w-1/3 text-sm font-medium",children:u.label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{children:e.jsx(M,{type:"number",value:o[m]??g.value??"",onChange:x=>{r(b=>({...b,[m]:x.target.value}))},onBlur:()=>{const x=o[m]?Number(o[m]):void 0;t(`musicPercentages.${m}.percentage`,x),d(),r(b=>{const N={...b};return delete N[m],N})},className:"flex grow"})}),e.jsx("span",{children:"%"})]})]})},m)}),i.includes("others")&&n.others&&e.jsx(W,{control:s,name:"musicPercentages.others.percentage",render:({field:m})=>e.jsxs(S,{className:"flex items-center justify-between gap-2",children:[e.jsx(w,{className:"w-1/3 text-sm font-medium",children:"Others"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(T,{children:e.jsx(M,{type:"number",value:o.others??m.value??"",onChange:u=>{r(g=>({...g,others:u.target.value}))},onBlur:()=>{const u=o.others?Number(o.others):void 0;t("musicPercentages.others.percentage",u),d(),r(g=>{const x={...g};return delete x.others,x})},className:"flex grow"})}),e.jsx("span",{children:"%"})]})]})},"others"),e.jsx(F,{})]})},Ot=({control:s,name:a})=>{const{getValues:t,setValue:c}=Z(),{field:{value:i,onChange:n}}=U({name:a,control:s}),o=(r,l)=>{const f=r?[...i||[],l]:(i==null?void 0:i.filter(d=>d!==l))||[];if(n(f),!r){const d=t("musicPercentages")||{},m=Object.fromEntries(Object.entries(d).filter(([u])=>u!==l));c("musicPercentages",m)}};return e.jsxs(S,{children:[e.jsx(w,{children:"Music"}),I.map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{id:r.id,checked:i==null?void 0:i.includes(r.id),onCheckedChange:l=>o(!!l,r.id)}),e.jsx(w,{htmlFor:r.id,className:"text-sm font-normal",children:r.label})]},r.id)),e.jsx(F,{})]})},Rt=({control:s,name:a})=>{const{field:{value:t,onChange:c}}=U({name:a,control:s}),[i,n]=h.useState(t===0),o=l=>{const f=l.target.value?Number(l.target.value):0;c(f),f>0&&n(!1)},r=()=>{const l=!i;n(l),c(l?0:"")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{control:s,name:a,render:()=>e.jsxs(S,{className:"text-start",children:[e.jsx(w,{htmlFor:"price",children:"Price"}),i?e.jsx("p",{className:"text-normal text-sm my-2",children:"Free"}):e.jsx(T,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"pe-1",children:"$"}),e.jsx(M,{placeholder:"0",id:"price",type:"number",value:t||"",onChange:o})]})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(oe,{id:"freeEvent",checked:i,onCheckedChange:r}),e.jsx("label",{htmlFor:"freeEvent",className:"px-1 text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"This is a free event"})]})]})},Vt=({control:s,name:a})=>{const{field:{ref:t,onBlur:c,onChange:i,...n},fieldState:{error:o}}=U({control:s,name:a});return e.jsxs(S,{className:"text-start",children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(T,{children:e.jsx(M,{id:"title",placeholder:"Dance Social",defaultValue:n.value,onBlur:r=>{i(r.target.value),c()},ref:t})}),e.jsx(F,{children:o==null?void 0:o.message})]})},de=p.object({name:p.string(),percentage:p.number().max(100,"Percentage cannot exceed 100%")}),At=p.object({title:p.string().min(3,"Title is required"),startTime:p.date({required_error:"A start date and time is required"}),endTime:p.date({required_error:"An end date and time is required"}),price:p.number(),description:p.string().optional(),image:p.instanceof(File).optional(),link:p.string().optional(),eventTags:p.array(p.string()).optional().default([]),music:p.array(p.string()).nonempty("Select at least one category"),musicPercentages:p.record(p.string(),de).and(p.object({others:de}).optional()).refine(s=>Object.values(s).reduce((a,t)=>a+t.percentage,0)<=100,{message:"Total music percentages cannot exceed 100%"}),location:p.object({propertyName:p.string().optional(),address:p.string().optional(),city:p.string().optional(),state:p.string().optional(),googleMapsUrl:p.string().optional(),lat:p.number().optional(),lng:p.number().optional()}).optional(),city:p.string().optional(),state:p.string().optional()}),$t=()=>Oe({resolver:Re(At),defaultValues:{music:["bachata","salsa"],location:{},eventTags:[],musicPercentages:{...Object.fromEntries(I.map(s=>[s.id,{name:s.label,percentage:s.id==="bachata"||s.id==="salsa"?50:0}])),others:{name:"Others",percentage:0}}}}),Ht=()=>{const[s,a]=h.useState(!1),{socialLink:t,websiteLink:c}=pe();return{onSubmit:async n=>{var f,d,m,u,g;a(!0);const o=z.currentUser;if(!o){k.error("You must be signed in to create an event."),a(!1);return}let r="";try{if(n.image instanceof File){const x=tt(ct,`events/${Date.now()}-${n.image.name}`);await st(x,n.image),r=await at(x)}}catch(x){console.error("Image upload failed:",x),k.error("Image upload failed."),a(!1);return}const l={title:n.title,startTime:n.startTime,endTime:n.endTime,imageUrl:r,description:(f=n.description)==null?void 0:f.trim(),price:n.price,eventTags:n.eventTags??[],music:n.music,musicPercentages:n.musicPercentages,location:n.location,city:((d=n.location)==null?void 0:d.city)??"",state:((m=n.location)==null?void 0:m.state)??"",link:n.link,organizerId:o.uid,organizerSocialLink:t,websiteLink:c,createdAt:rt()};try{const x=L(he(P,"events")),b=x.id,N=((u=l.location)==null?void 0:u.city)??"Unknown City",D=((g=l.location)==null?void 0:g.state)??"Unknown State",y=L(P,"states",D),C=await re(y);await V(x,l),C.exists()||await V(y,{});const E=L(P,"states",D,"cities",N,"events",b);await V(E,l),await V(L(P,"organizers",o.uid,"events",b),l),k.success("Event created!",{description:new Date().toLocaleString()}),console.log("Event successfully created!")}catch(x){console.error("Firestore error:",x),k.error("Failed to save event to Firestore.")}a(!1)},loading:s}},Bt=({className:s,...a})=>{const t=$t(),c=t.watch(),{onSubmit:i,loading:n}=Ht();return e.jsx("div",{className:j("w-full flex flex-col gap-6 m-2",s),...a,children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsx(se,{className:"text-2xl",children:"Create Event"})}),e.jsxs(ae,{children:[e.jsx(yt,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(i),className:"flex flex-col justify-center py-2 gap-4",children:[e.jsx(Vt,{control:t.control,name:"title"}),e.jsx(zt,{control:t.control,name:"location"}),e.jsx(ce,{form:t,label:"Start time",formFieldName:"startTime"}),e.jsx(ce,{form:t,label:"End time",formFieldName:"endTime"}),e.jsx(Mt,{control:t.control,name:"image"}),e.jsx(Pt,{control:t.control,name:"description"}),e.jsx(Rt,{control:t.control,name:"price"}),e.jsx(Tt,{control:t.control,name:"eventTags"}),e.jsx(Ot,{control:t.control,name:"music"}),e.jsx(Ut,{}),e.jsx(It,{control:t.control,name:"link"})]})}),e.jsx(Lt,{form:t,formValues:c,onSubmit:i,loading:n})]})]})})},qt=()=>{const[s]=nt(z),[a,t]=h.useState([]),[c,i]=h.useState(!0);if(h.useEffect(()=>{if(!s)return;(async()=>{try{const r=he(P,`organizers/${s.uid}/events`),l=ot(r,it("createdAt","desc")),d=(await lt(l)).docs.map(m=>{const u=m.data();return{id:m.id,...u,createdAt:u.createdAt.toDate(),startTime:u.startTime.toDate(),endTime:u.endTime.toDate()}});t(d)}catch(r){console.error("Error fetching previous posts:",r)}finally{i(!1)}})()},[s]),!s)return e.jsx("p",{children:"Please log in to view your previous posts."});if(c)return e.jsx("p",{children:"Loading previous posts..."});const n=async o=>{if(s)try{const r=L(P,"events",o);await le(r);const l=L(P,`organizers/${s.uid}/events`,o);await le(l),k.success("Event deleted successfully!"),t(f=>f.filter(d=>d.id!==o))}catch(r){console.error("Error deleting event:",r)}};return a.length===0?e.jsx("p",{className:"mt-2",children:"No previously events posted"}):e.jsx("div",{className:"flex flex-col",children:a.map(o=>e.jsxs("div",{className:"border rounded-md p-2 m-2 relative",children:[e.jsx(xe,{social:o}),e.jsxs(K,{children:[e.jsx(G,{asChild:!0,children:e.jsx(v,{variant:"destructive",children:"Delete"})}),e.jsxs(J,{children:[e.jsxs(Y,{children:[e.jsx(Q,{children:"Are you sure you want to delete this event?"}),e.jsx(Je,{children:"This will permanently delete the event from both your organizer account and the global events list"})]}),e.jsxs(me,{children:[e.jsx(v,{variant:"outline",children:"Cancel"}),e.jsx(v,{variant:"destructive",onClick:()=>n(o.id),children:"Confirm Delete"})]})]})]})]},o.id))})},Wt=()=>{const[s,a]=h.useState(!0),[t,c]=h.useState([]),[i,n]=h.useState([]),{loading:o,error:r,profileData:l}=Ft(),{loading:f,error:d,success:m,updateProfile:u}=Et();h.useEffect(()=>{if(l&&i.length===0){const b=[{label:"Email",value:l.email},{label:"First name",value:l.firstName||""},{label:"Last name",value:l.lastName||""},{label:"Social Media",value:l.socialMediaLink??""},{label:"Website",value:l.websiteLink??""}].map(N=>({...N}));n(b),c(b)}},[l,i.length]),h.useEffect(()=>()=>{k.dismiss()},[]);const g=async()=>{if(!l){k.error("Profile data not found");return}const x={"First name":"firstName","Last name":"lastName","Social Media":"socialMediaLink",Website:"websiteLink"},b=t.reduce((y,C)=>{const E=x[C.label];return E&&(y[E]=C.value),y},{}),{...N}=b;if(!t.some(y=>{const C=i.find(E=>E.label===y.label);return(C==null?void 0:C.value)!==y.value})){k("No changes detected. Profile not updated");return}await u(N),n(t.map(y=>({...y}))),a(!0)};if(h.useEffect(()=>{m&&k.success("Successfully updated your profile"),d&&k.error("An error occurred while updating profile, please try again")},[m,d]),o)return e.jsx("div",{children:e.jsx("p",{children:"Profile loading..."})});if(r){k.error(r);return}return e.jsxs("div",{className:"flex flex-col items-center mt-4",children:[e.jsx(Ve,{richColors:!0,position:"top-center",className:"text-start"}),e.jsx("div",{children:e.jsxs(ee,{className:"md:w-[450px]",children:[e.jsx(te,{children:e.jsx(se,{children:"Profile"})}),e.jsx(ae,{children:e.jsx("ul",{className:"flex-col mt-4",children:t.map((x,b)=>e.jsxs("li",{className:"flex gap-1 items-center text-start mb-2 justify-between",children:[e.jsx("label",{className:"w-1/4",children:x.label}),e.jsx(M,{value:x.value,onChange:N=>{const D=t.map((y,C)=>C===b?{...y,value:N.target.value}:y);c(D)},disabled:x.label==="Email"||s,className:"w-3/4"})]},x.label))})}),e.jsxs(Ye,{className:"flex justify-between",children:[e.jsx(v,{variant:"link",onClick:()=>{a(!s)},disabled:!s,children:"Edit Profile"}),e.jsx(v,{onClick:g,disabled:f||s,variant:s?"outline":"default",children:"Update Profile"})]})]})})]})},Kt=({className:s,...a})=>e.jsx("div",{className:j("flex flex-col gap-6 m-2",s),...a,children:e.jsxs(ee,{className:"min-h-svh",children:[e.jsx(te,{children:e.jsx(se,{className:"text-2xl",children:"Organizer Dashboard"})}),e.jsx(ae,{children:e.jsx("div",{className:"flex min-h-full w-full justify-center px-0 sm:px-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(dt,{defaultValue:"create-post",className:"w-full",children:[e.jsxs(ut,{className:"grid w-full grid-cols-3",children:[e.jsx(H,{value:"create-post",children:"Create Post"}),e.jsx(H,{value:"post",children:"Posts"}),e.jsx(H,{value:"profile",children:"Profile"})]}),e.jsx(B,{value:"create-post",className:"flex",children:e.jsx(Bt,{})}),e.jsx(B,{value:"post",children:e.jsx(qt,{})}),e.jsx(B,{value:"profile",children:e.jsx(Wt,{})})]})})})})]})});function as(){const s=ue();return h.useEffect(()=>{const a=A.get("auth_token");a?a===void 0&&s("/"):s("/login")},[s]),e.jsxs("div",{children:[e.jsx(Qe,{}),e.jsx(Kt,{}),e.jsx(bt,{})]})}export{as as default};
