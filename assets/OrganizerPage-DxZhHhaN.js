import{u as fe,j as e,F as we,r as x,S as Ne,d as G,e as te,f as Ce,D as Se,g as ke,h as Pe,i as Fe,k as Te,P as Ee,l as Le,m as De,V as ze,n as Me,o as Ie,p as _e,q as Oe,s as O,t as Ue,v as Re,w as Ae,I as Ve,x as $e,y as He,z as k,T as Be}from"./react-BV_0FzY6.js";import{aE as H,ao as qe,ai as We,aF as V,aG as $,aH as y,aI as Ke,aJ as ce,aK as Ge,aL as de}from"./vendor-DUxuRwNf.js";import{B as j,c as p,L as Je,d as ue,S as Ye,e as Qe,f as Xe,g as Ze,h as R,D as J,i as Y,j as Q,k as X,l as Z,m as ge,n as et,C as se,a as ae,o as re,b as ne,p as tt,q as st,H as at}from"./card-DNYd950U.js";import{s as rt,o as nt,e as E,f as oe,u as ot,r as it,h as lt,j as ct,d as pe,k as dt,l as A,m as ut,q as mt,n as xt,c as ht,p as me}from"./firebase-DyRbBIhJ.js";import{a as z,d as P,s as ft}from"./index-BBtiRiNo.js";import{I as M,T as gt,a as pt,b as q,c as W}from"./input-CBJ8geOo.js";import{E as je,e as jt,m as vt,a as _}from"./EventCard-B9O4Rz2Z.js";import{u as bt,A as yt,G as wt,M as Nt,I as Ct}from"./google-maps-CdSZERwW.js";import"./shadcn-ui-BA32w1ww.js";const St=()=>{const s=fe();return{handleSignOut:async()=>{try{const t=await rt(z);console.log(t),H.remove("auth_token"),s("/login")}catch(t){console.error("Error during sign out: ",t)}}}},kt=()=>{const{handleSignOut:s}=St();return e.jsx(j,{onClick:s,children:"Log out"})},Pt=we,ve=x.createContext({}),U=({...s})=>e.jsx(ve.Provider,{value:{name:s.name},children:e.jsx(G,{...s})}),ie=()=>{const s=x.useContext(ve),a=x.useContext(be),{getFieldState:t}=te(),o=Ce({name:s.name}),l=t(s.name,o);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:n}=a;return{id:n,name:s.name,formItemId:`${n}-form-item`,formDescriptionId:`${n}-form-item-description`,formMessageId:`${n}-form-item-message`,...l}},be=x.createContext({});function S({className:s,...a}){const t=x.useId();return e.jsx(be.Provider,{value:{id:t},children:e.jsx("div",{"data-slot":"form-item",className:p("grid gap-2",s),...a})})}function w({className:s,...a}){const{error:t,formItemId:o}=ie();return e.jsx(Je,{"data-slot":"form-label","data-error":!!t,className:p("data-[error=true]:text-destructive",s),htmlFor:o,...a})}function L({...s}){const{error:a,formItemId:t,formDescriptionId:o,formMessageId:l}=ie();return e.jsx(Ne,{"data-slot":"form-control",id:t,"aria-describedby":a?`${o} ${l}`:`${o}`,"aria-invalid":!!a,...s})}function F({className:s,...a}){const{error:t,formMessageId:o}=ie(),l=t?String((t==null?void 0:t.message)??""):a.children;return l?e.jsx("p",{"data-slot":"form-message",id:o,className:p("text-destructive text-sm",s),...a,children:l}):null}function Ft({className:s,classNames:a,showOutsideDays:t=!0,...o}){return e.jsx(Se,{showOutsideDays:t,className:p("p-3",s),classNames:{months:"flex flex-col sm:flex-row gap-2",month:"flex flex-col gap-4",caption:"flex justify-center pt-1 relative items-center w-full",caption_label:"text-sm font-medium",nav:"flex items-center gap-1",nav_button:p(ue({variant:"outline"}),"size-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-x-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:p("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-range-end)]:rounded-r-md",o.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:p(ue({variant:"ghost"}),"size-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start aria-selected:bg-primary aria-selected:text-primary-foreground",day_range_end:"day-range-end aria-selected:bg-primary aria-selected:text-primary-foreground",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:({className:l,...n})=>e.jsx(Pe,{className:p("size-4",l),...n}),IconRight:({className:l,...n})=>e.jsx(ke,{className:p("size-4",l),...n})},...o})}function Tt({...s}){return e.jsx(Fe,{"data-slot":"popover",...s})}function Et({...s}){return e.jsx(Te,{"data-slot":"popover-trigger",...s})}function Lt({className:s,align:a="center",sideOffset:t=4,...o}){return e.jsx(Ee,{children:e.jsx(Le,{"data-slot":"popover-content",align:a,sideOffset:t,className:p("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",s),...o})})}function K({className:s,children:a,...t}){return e.jsxs(De,{"data-slot":"scroll-area",className:p("relative",s),...t,children:[e.jsx(ze,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),e.jsx(ee,{}),e.jsx(Me,{})]})}function ee({className:s,orientation:a="vertical",...t}){return e.jsx(Ie,{"data-slot":"scroll-area-scrollbar",orientation:a,className:p("flex touch-none p-px transition-colors select-none",a==="vertical"&&"h-full w-2.5 border-l border-l-transparent",a==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",s),...t,children:e.jsx(_e,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}const xe=({form:s,label:a,formFieldName:t})=>{function o(i){i&&s.setValue(t,i)}function l(i){const r=We(new Date,parseInt(i)),c=s.getValues(t);c?r.setHours(c.getHours(),c.getMinutes(),c.getSeconds()):r.setHours(0,0,0,0),s.setValue(t,r)}function n(i,r){const c=s.getValues(t)||new Date,f=new Date(c);if(i==="hour"){const d=parseInt(r,10);f.getHours()>=12?f.setHours(d+12):f.setHours(d%12)}else if(i==="minute")f.setMinutes(parseInt(r,10));else if(i==="ampm"){const d=f.getHours();r==="AM"&&d>=12?f.setHours(d-12):r==="PM"&&d<12&&f.setHours(d+12)}s.setValue(t,f)}return e.jsx(U,{control:s.control,name:t,render:({field:i})=>e.jsxs(S,{className:"flex flex-col text-start",children:[e.jsx(w,{children:a}),e.jsxs(Tt,{children:[e.jsx(Et,{asChild:!0,children:e.jsx(L,{children:e.jsxs(j,{variant:"outline",className:p("w-full pl-3 text-left font-normal",!i.value&&"text-muted-foreground"),children:[i.value?qe(i.value,"MM/dd/yyyy hh:mm aa"):e.jsx("span",{children:"Select date and time"}),e.jsx(Oe,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(Lt,{className:"w-auto p-2",children:e.jsxs("div",{className:"flex-col sm:flex",children:[e.jsx("div",{children:e.jsxs(Ye,{onValueChange:l,children:[e.jsx(Qe,{children:e.jsx(Xe,{placeholder:"Select"})}),e.jsxs(Ze,{position:"popper",children:[e.jsx(R,{value:"0",children:"Today"}),e.jsx(R,{value:"1",children:"Tomorrow"}),e.jsx(R,{value:"3",children:"In 3 days"}),e.jsx(R,{value:"7",children:"In a week"})]})]})}),e.jsxs("div",{className:"sm:flex",children:[e.jsx(Ft,{mode:"single",selected:i.value,onSelect:o,initialFocus:!0}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:h-[300px] divide-y sm:divide-y-0 sm:divide-x",children:[e.jsxs(K,{className:"w-64 sm:w-auto",children:[e.jsx("div",{className:"flex sm:flex-col p-2",children:Array.from({length:12},(r,c)=>c+1).reverse().map(r=>e.jsx(j,{size:"icon",variant:i.value&&i.value.getHours()%12===r%12?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("hour",r.toString()),children:r},r))}),e.jsx(ee,{orientation:"horizontal",className:"sm:hidden"})]}),e.jsxs(K,{className:"w-64 sm:w-auto",children:[e.jsx("div",{className:"flex sm:flex-col p-2",children:Array.from({length:12},(r,c)=>c*5).map(r=>e.jsx(j,{size:"icon",variant:i.value&&i.value.getMinutes()===r?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("minute",r.toString()),children:r.toString().padStart(2,"0")},r))}),e.jsx(ee,{orientation:"horizontal",className:"sm:hidden"})]}),e.jsx(K,{className:"",children:e.jsx("div",{className:"flex sm:flex-col p-2",children:["AM","PM"].map(r=>e.jsx(j,{size:"icon",variant:i.value&&(r==="AM"&&i.value.getHours()<12||r==="PM"&&i.value.getHours()>=12)?"default":"ghost",className:"sm:w-full shrink-0 aspect-square",onClick:()=>n("ampm",r),children:r},r))})})]})]})]})})]}),e.jsx(F,{})]})})};function Dt({className:s,...a}){return e.jsx("textarea",{"data-slot":"textarea",className:p("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),...a})}const zt=({control:s,name:a})=>{const{field:t,fieldState:{error:o}}=O({name:a,control:s}),[l,n]=x.useState(t.value??""),i=()=>{t.onChange(l),t.onBlur()};return e.jsxs(S,{children:[e.jsx(w,{children:"Description"}),e.jsx(L,{children:e.jsx(Dt,{value:l,onChange:r=>n(r.target.value),onBlur:i,placeholder:"Describe your event..."})}),e.jsx(F,{children:o==null?void 0:o.message})]})},Mt=()=>{const[s,a]=x.useState(!0),[t,o]=x.useState(null),[l,n]=x.useState(null);return x.useEffect(()=>{if(H.get("auth_token")){const r=nt(z,async c=>{if(c){const f=E(P,"organizers",c.uid),d=await oe(f);d.exists()?n(d.data()):o("No organizer data found")}else o("User not authenticated");a(!1)});return()=>r()}else a(!1),o("No authentication token found. Please log in")},[]),{loading:s,error:t,profileData:l}},ye=()=>{const[s,a]=x.useState(null),[t,o]=x.useState(null),[l,n]=x.useState(!0);return x.useEffect(()=>{(async()=>{const r=z.currentUser;if(!r){n(!1);return}try{const c=E(P,"organizers",r.uid),f=await oe(c);if(f.exists()){const d=f.data();a((d==null?void 0:d.socialMediaLink)??null),o((d==null?void 0:d.websiteLink)??null)}}catch(c){console.warn("Could not fetch organizer social link:",c)}finally{n(!1)}})()},[]),{socialLink:s,websiteLink:t,loading:l}},It=()=>{const[s,a]=x.useState(!1),[t,o]=x.useState(null),[l,n]=x.useState(!1);return{loading:s,error:t,success:l,updateProfile:async r=>{var f;if(a(!0),o(null),n(!1),H.get("auth_token"))try{await((f=z.currentUser)==null?void 0:f.getIdToken(!0));const d=z.currentUser;if(d){const m=E(P,"organizers",d.uid);await ot(m,r),n(!0)}else o("User not authenticated")}catch(d){console.error("Error updating profile:",d),o("Failed to update profile. Please try again.")}finally{a(!1)}else a(!1),o("No authentication token found. Please log in again.")}}},_t=({form:s,formValues:a,onSubmit:t,loading:o})=>{const[l,n]=x.useState(!1),{socialLink:i}=ye();return e.jsxs("div",{className:"flex gap-4 justify-between",children:[e.jsxs(J,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",disabled:!s.formState.isValid,children:"Preview Event"})}),e.jsxs(Q,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Preview Event"})}),e.jsx("div",{className:"text-center overflow-y-auto max-h-[75vh]",children:e.jsx(je,{social:{id:"preview",...a,imageUrl:a.image instanceof File?URL.createObjectURL(a.image):"",createdAt:new Date,organizerSocialLink:i??""}})})]})]}),e.jsxs(J,{open:l,onOpenChange:n,children:[e.jsx(Y,{asChild:!0,children:e.jsx(j,{type:"button",disabled:o||!s.formState.isValid,onClick:()=>n(!0),children:o?"Submitting...":"Post Event"})}),e.jsxs(Q,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Confirm Event Submission"})}),e.jsx("p",{children:"Are you sure you want to post this event? Please double-check your details 💃"}),e.jsxs(ge,{children:[e.jsx(et,{asChild:!0,children:e.jsx(j,{variant:"outline",children:"Cancel"})}),e.jsx(j,{onClick:s.handleSubmit(r=>{n(!1),t(r)}),disabled:o||!s.formState.isValid,children:"Yes, Post It"})]})]})]})]})};function le({className:s,...a}){return e.jsx(Ue,{"data-slot":"checkbox",className:p("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...a,children:e.jsx(Re,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(Ae,{className:"size-3.5"})})})}const Ot=({control:s,name:a})=>{const{field:{value:t,onChange:o}}=O({name:a,control:s}),l=(n,i)=>{const r=n?[...t||[],i]:(t||[]).filter(c=>c!==i);o(r)};return e.jsxs(S,{className:"space-y-2",children:[e.jsx(w,{children:"Event Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2 max-sm:flex-col",children:jt.map(n=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{id:n,checked:t==null?void 0:t.includes(n),onCheckedChange:i=>l(!!i,n)}),e.jsx(w,{htmlFor:n,className:"text-sm font-normal",children:n})]},n))}),e.jsx(F,{})]})},Ut=["places","marker"],I={lat:43.0722,lng:-89.4008},Rt=({control:s,name:a})=>{const[t,o]=x.useState(null),[l,n]=x.useState(!1),[i,r]=x.useState(I),c=x.useRef(null),{isLoaded:f}=bt({googleMapsApiKey:"AIzaSyBuImOK6KWeeg3f71cgw6R-ssJj4arkAjk",libraries:Ut}),d=m=>{var N,D,b,C,T;if(!c.current)return;const u=c.current.getPlace();if(!((N=u.geometry)!=null&&N.location))return;const g=u.geometry.location.lat(),h=u.geometry.location.lng(),v={propertyName:u.name??"",address:u.formatted_address??"",city:(b=(D=u.address_components)==null?void 0:D.find(B=>B.types.includes("locality")))==null?void 0:b.long_name,state:(T=(C=u.address_components)==null?void 0:C.find(B=>B.types.includes("administrative_area_level_1")))==null?void 0:T.short_name,googleMapsUrl:u.url??`https://www.google.com/maps/search/?api=1&query=${g},${h}`,lat:g,lng:h};o(v),r({lat:g,lng:h}),m(v)};return f?e.jsx(U,{control:s,name:a,render:({field:m})=>e.jsxs(S,{children:[e.jsx(w,{htmlFor:a,children:"Event Location"}),e.jsx(L,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(yt,{onLoad:u=>c.current=u,onPlaceChanged:()=>d(m.onChange),children:e.jsx(M,{id:"location",placeholder:"Search for a location...",className:"w-full"})}),e.jsx("div",{className:"w-full h-72 rounded-md border",children:e.jsxs(wt,{center:i,zoom:15,mapContainerClassName:"w-full h-full rounded-2xl",options:vt,children:[t&&e.jsx(Nt,{position:{lat:i.lat??I.lat,lng:i.lng??I.lng},onClick:()=>n(!0)}),t&&l&&e.jsx(Ct,{position:{lat:i.lat??I.lat,lng:i.lng??I.lng},onCloseClick:()=>n(!1),children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("h3",{className:"font-semibold text-md text-primary",children:t.propertyName}),e.jsx("p",{className:"text-sm text-gray-500",children:t.address}),t.city&&t.state&&e.jsxs("p",{className:"text-sm text-gray-400",children:[t.city,", ",t.state]}),e.jsx("a",{href:t.googleMapsUrl,target:"_blank",rel:"noopener noreferrer",className:"text-primary underline text-sm",children:"View on Google Maps"})]})})]})})]})}),e.jsx(F,{})]})}):e.jsx("p",{children:"Loading map..."})},At=({control:s,name:a})=>e.jsx(U,{control:s,name:a,render:({field:t})=>e.jsxs(S,{children:[e.jsx(w,{htmlFor:"imageUpload",children:"Upload Image"}),e.jsx(L,{children:e.jsx(Vt,{id:"imageUpload",value:t.value||void 0,onChange:t.onChange})}),e.jsx(F,{})]})}),Vt=({id:s,value:a,onChange:t})=>{const[o,l]=x.useState(null),n=x.useRef(null);x.useEffect(()=>{let r=null;return a instanceof File?(r=URL.createObjectURL(a),l(r)):l(null),()=>{r&&URL.revokeObjectURL(r)}},[a]);const i=r=>{var f;const c=(f=r[0])==null?void 0:f.file;c instanceof File?t(c):(console.warn("Selected image is not a valid File object"),t(void 0))};return e.jsx(Ve,{multiple:!1,value:a?[{file:a,data_url:o??""}]:[],onChange:i,dataURLKey:"data_url",children:({onImageUpload:r,onImageUpdate:c,onImageRemove:f,isDragging:d,dragProps:m})=>e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("input",{id:s,type:"file",ref:n,className:"hidden",onChange:u=>{var h;const g=(h=u.target.files)==null?void 0:h[0];g instanceof File&&t(g)}}),e.jsx(j,{type:"button",style:d?{backgroundColor:"limegreen",transition:"0.25s"}:void 0,onClick:r,...m,children:"Click or Drop image here"}),o&&e.jsxs("div",{children:[e.jsx("img",{src:o,alt:"event preview",className:"rounded-2xl"}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(j,{type:"button",onClick:()=>c(0),children:"Update"}),e.jsx(j,{type:"button",onClick:()=>f(0),children:"Remove"})]})]})]})})},$t=({control:s,name:a})=>e.jsx(U,{control:s,name:a,render:({field:t})=>e.jsxs(S,{children:[e.jsx(w,{children:"Link"}),e.jsx(L,{children:e.jsx(M,{placeholder:"event link (optional)","aria-label":"link for additional details",...t})}),e.jsx(F,{})]})}),Ht=()=>{const{control:s,watch:a,setValue:t,trigger:o}=te(),l=a("music",["bachata","salsa"]),n=a("musicPercentages",{}),[i,r]=x.useState({}),[c,f]=x.useState(!1),d=x.useCallback(()=>{const m=Object.entries(n).filter(([g])=>g!=="others").reduce((g,[,h])=>g+((h==null?void 0:h.percentage)??0),0),u=Math.max(100-m,0);u>0?(t("musicPercentages.others",{name:"Others",percentage:u}),l.includes("others")||t("music",[...l,"others"])):(t("musicPercentages.others",{name:"Others",percentage:0}),l.includes("others")&&t("music",l.filter(g=>g!=="others"))),o("musicPercentages")},[n,l,t,o]);return x.useEffect(()=>{c||(l.forEach(m=>{var u;n[m]||t(`musicPercentages.${m}`,{name:((u=_.find(g=>g.id===m))==null?void 0:u.label)??m,percentage:m==="bachata"||m==="salsa"?50:0}),r(g=>({...g,[m]:`${m==="bachata"||m==="salsa"?50:0}`}))}),f(!0))},[l,n,t,c]),x.useEffect(()=>{Object.keys(n).filter(u=>u!=="others"&&!l.includes(u)).forEach(u=>{var g;t(`musicPercentages.${u}`,{name:((g=_.find(h=>h.id===u))==null?void 0:g.label)??u,percentage:0}),r(h=>({...h,[u]:"0"}))})},[l,n,t]),x.useEffect(()=>{d()},[n,d]),e.jsxs(S,{className:"space-y-2",children:[e.jsx(w,{children:"Music Breakdown"}),l.length===0?e.jsx("p",{className:"text-start text-sm text-gray-500",children:"No music categories selected"}):l.map(m=>{const u=_.find(g=>g.id===m);return u&&e.jsx(G,{control:s,name:`musicPercentages.${m}.percentage`,render:({field:g})=>e.jsxs(S,{className:"flex items-center justify-between gap-2",children:[e.jsx(w,{className:"w-1/3 text-sm font-medium",children:u.label}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{children:e.jsx(M,{type:"number",value:i[m]??g.value??"",onChange:h=>{r(v=>({...v,[m]:h.target.value}))},onBlur:()=>{const h=i[m]?Number(i[m]):void 0;t(`musicPercentages.${m}.percentage`,h),d(),r(v=>{const N={...v};return delete N[m],N})},className:"flex grow"})}),e.jsx("span",{children:"%"})]})]})},m)}),l.includes("others")&&n.others&&e.jsx(G,{control:s,name:"musicPercentages.others.percentage",render:({field:m})=>e.jsxs(S,{className:"flex items-center justify-between gap-2",children:[e.jsx(w,{className:"w-1/3 text-sm font-medium",children:"Others"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{children:e.jsx(M,{type:"number",value:i.others??m.value??"",onChange:u=>{r(g=>({...g,others:u.target.value}))},onBlur:()=>{const u=i.others?Number(i.others):void 0;t("musicPercentages.others.percentage",u),d(),r(g=>{const h={...g};return delete h.others,h})},className:"flex grow"})}),e.jsx("span",{children:"%"})]})]})},"others"),e.jsx(F,{})]})},Bt=({control:s,name:a})=>{const{getValues:t,setValue:o}=te(),{field:{value:l,onChange:n}}=O({name:a,control:s}),i=(r,c)=>{const f=r?[...l||[],c]:(l==null?void 0:l.filter(d=>d!==c))||[];if(n(f),!r){const d=t("musicPercentages")||{},m=Object.fromEntries(Object.entries(d).filter(([u])=>u!==c));o("musicPercentages",m)}};return e.jsxs(S,{children:[e.jsx(w,{children:"Music"}),_.map(r=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{id:r.id,checked:l==null?void 0:l.includes(r.id),onCheckedChange:c=>i(!!c,r.id)}),e.jsx(w,{htmlFor:r.id,className:"text-sm font-normal",children:r.label})]},r.id)),e.jsx(F,{})]})},qt=({control:s,name:a})=>{const{field:{value:t,onChange:o}}=O({name:a,control:s}),[l,n]=x.useState(t===0),i=c=>{const f=c.target.value?Number(c.target.value):0;o(f),f>0&&n(!1)},r=()=>{const c=!l;n(c),o(c?0:"")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx(U,{control:s,name:a,render:()=>e.jsxs(S,{className:"text-start",children:[e.jsx(w,{htmlFor:"price",children:"Price"}),l?e.jsx("p",{className:"text-normal text-sm my-2",children:"Free"}):e.jsx(L,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"pe-1",children:"$"}),e.jsx(M,{placeholder:"0",id:"price",type:"number",value:t||"",onChange:i})]})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{id:"freeEvent",checked:l,onCheckedChange:r}),e.jsx("label",{htmlFor:"freeEvent",className:"px-1 text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"This is a free event"})]})]})},Wt=({control:s,name:a})=>{const{field:{ref:t,onBlur:o,onChange:l,...n},fieldState:{error:i}}=O({control:s,name:a});return e.jsxs(S,{className:"text-start",children:[e.jsx(w,{htmlFor:"title",children:"Title"}),e.jsx(L,{children:e.jsx(M,{id:"title",placeholder:"Dance Social",defaultValue:n.value,onBlur:r=>{l(r.target.value),o()},ref:t})}),e.jsx(F,{children:i==null?void 0:i.message})]})},he=V({name:y(),percentage:$().max(100,"Percentage cannot exceed 100%")}),Kt=V({title:y().min(3,"Title is required"),startTime:de({required_error:"A start date and time is required"}),endTime:de({required_error:"An end date and time is required"}),price:$(),description:y().optional(),image:Ge(File).optional(),link:y().optional(),eventTags:ce(y()).optional().default([]),music:ce(y()).nonempty("Select at least one category"),musicPercentages:Ke(y(),he).and(V({others:he}).optional()).refine(s=>Object.values(s).reduce((a,t)=>a+t.percentage,0)<=100,{message:"Total music percentages cannot exceed 100%"}),location:V({propertyName:y().optional(),address:y().optional(),city:y().optional(),state:y().optional(),googleMapsUrl:y().optional(),lat:$().optional(),lng:$().optional()}).optional(),city:y().optional(),state:y().optional()}),Gt=()=>$e({resolver:He(Kt),defaultValues:{music:["bachata","salsa"],location:{},eventTags:[],musicPercentages:{...Object.fromEntries(_.map(s=>[s.id,{name:s.label,percentage:s.id==="bachata"||s.id==="salsa"?50:0}])),others:{name:"Others",percentage:0}}}}),Jt=()=>{const[s,a]=x.useState(!1),{socialLink:t,websiteLink:o}=ye();return{onSubmit:async n=>{var f,d,m,u,g;a(!0);const i=z.currentUser;if(!i){k.error("You must be signed in to create an event."),a(!1);return}let r="";try{if(n.image instanceof File){const h=it(ft,`events/${Date.now()}-${n.image.name}`);await lt(h,n.image),r=await ct(h)}}catch(h){console.error("Image upload failed:",h),k.error("Image upload failed."),a(!1);return}const c={title:n.title,startTime:n.startTime,endTime:n.endTime,imageUrl:r,description:(f=n.description)==null?void 0:f.trim(),price:n.price,eventTags:n.eventTags??[],music:n.music,musicPercentages:n.musicPercentages,location:n.location,city:((d=n.location)==null?void 0:d.city)??"",state:((m=n.location)==null?void 0:m.state)??"",link:n.link,organizerId:i.uid,organizerSocialLink:t,websiteLink:o,createdAt:dt()};try{const h=E(pe(P,"events")),v=h.id,N=((u=c.location)==null?void 0:u.city)??"Unknown City",D=((g=c.location)==null?void 0:g.state)??"Unknown State",b=E(P,"states",D),C=await oe(b);await A(h,c),C.exists()||await A(b,{});const T=E(P,"states",D,"cities",N,"events",v);await A(T,c),await A(E(P,"organizers",i.uid,"events",v),c),k.success("Event created!",{description:new Date().toLocaleString()}),console.log("Event successfully created!")}catch(h){console.error("Firestore error:",h),k.error("Failed to save event to Firestore.")}a(!1)},loading:s}},Yt=({className:s,...a})=>{const t=Gt(),o=t.watch(),{onSubmit:l,loading:n}=Jt();return e.jsx("div",{className:p("w-full flex flex-col gap-6 m-2",s),...a,children:e.jsxs(se,{children:[e.jsx(ae,{children:e.jsx(re,{className:"text-2xl",children:"Create Event"})}),e.jsxs(ne,{children:[e.jsx(Pt,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(l),className:"flex flex-col justify-center py-2 gap-4",children:[e.jsx(Wt,{control:t.control,name:"title"}),e.jsx(Rt,{control:t.control,name:"location"}),e.jsx(xe,{form:t,label:"Start time",formFieldName:"startTime"}),e.jsx(xe,{form:t,label:"End time",formFieldName:"endTime"}),e.jsx(At,{control:t.control,name:"image"}),e.jsx(zt,{control:t.control,name:"description"}),e.jsx(qt,{control:t.control,name:"price"}),e.jsx(Ot,{control:t.control,name:"eventTags"}),e.jsx(Bt,{control:t.control,name:"music"}),e.jsx(Ht,{}),e.jsx($t,{control:t.control,name:"link"}),e.jsx("pre",{className:"text-start bg-gray-100 p-2 rounded-md text-sm overflow-auto",children:JSON.stringify({...o,image:o.image?o.image.name:"No image",startTime:o.startTime?o.startTime.toLocaleString():"No start time",endTime:o.endTime?o.endTime.toLocaleString():"No start time"},null,2)})]})}),e.jsx(_t,{form:t,formValues:o,onSubmit:l,loading:n})]})]})})},Qt=()=>{const[s]=ut(z),[a,t]=x.useState([]),[o,l]=x.useState(!0);if(x.useEffect(()=>{if(!s)return;(async()=>{try{const r=pe(P,`organizers/${s.uid}/events`),c=mt(r,xt("createdAt","desc")),d=(await ht(c)).docs.map(m=>{const u=m.data();return{id:m.id,...u,createdAt:u.createdAt.toDate(),startTime:u.startTime.toDate(),endTime:u.endTime.toDate()}});t(d)}catch(r){console.error("Error fetching previous posts:",r)}finally{l(!1)}})()},[s]),!s)return e.jsx("p",{children:"Please log in to view your previous posts."});if(o)return e.jsx("p",{children:"Loading previous posts..."});const n=async i=>{if(s)try{const r=E(P,"events",i);await me(r);const c=E(P,`organizers/${s.uid}/events`,i);await me(c),k.success("Event deleted successfully!"),t(f=>f.filter(d=>d.id!==i))}catch(r){console.error("Error deleting event:",r)}};return a.length===0?e.jsx("p",{className:"mt-2",children:"No previously events posted"}):e.jsx("div",{className:"flex flex-col",children:a.map(i=>e.jsxs("div",{className:"border rounded-md p-2 m-2 relative",children:[e.jsx(je,{social:i}),e.jsxs(J,{children:[e.jsx(Y,{asChild:!0,children:e.jsx(j,{variant:"destructive",children:"Delete"})}),e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(Z,{children:"Are you sure you want to delete this event?"}),e.jsx(tt,{children:"This will permanently delete the event from both your organizer account and the global events list"})]}),e.jsxs(ge,{children:[e.jsx(j,{variant:"outline",children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:()=>n(i.id),children:"Confirm Delete"})]})]})]})]},i.id))})},Xt=()=>{const[s,a]=x.useState(!0),[t,o]=x.useState([]),[l,n]=x.useState([]),{loading:i,error:r,profileData:c}=Mt(),{loading:f,error:d,success:m,updateProfile:u}=It();x.useEffect(()=>{if(c&&l.length===0){const v=[{label:"Email",value:c.email},{label:"First name",value:c.firstName||""},{label:"Last name",value:c.lastName||""},{label:"Social Media",value:c.socialMediaLink??""},{label:"Website",value:c.websiteLink??""}].map(N=>({...N}));n(v),o(v)}},[c,l.length]),x.useEffect(()=>()=>{k.dismiss()},[]);const g=async()=>{if(!c){k.error("Profile data not found");return}const h={"First name":"firstName","Last name":"lastName","Social Media":"socialMediaLink",Website:"websiteLink"},v=t.reduce((b,C)=>{const T=h[C.label];return T&&(b[T]=C.value),b},{}),{...N}=v;if(!t.some(b=>{const C=l.find(T=>T.label===b.label);return(C==null?void 0:C.value)!==b.value})){k("No changes detected. Profile not updated");return}await u(N),n(t.map(b=>({...b}))),a(!0)};if(x.useEffect(()=>{m&&k.success("Successfully updated your profile"),d&&k.error("An error occurred while updating profile, please try again")},[m,d]),i)return e.jsx("div",{children:e.jsx("p",{children:"Profile loading..."})});if(r){k.error(r);return}return e.jsxs("div",{className:"flex flex-col items-center mt-4",children:[e.jsx(Be,{richColors:!0,position:"top-center",className:"text-start"}),e.jsx("div",{children:e.jsxs(se,{className:"md:w-[450px]",children:[e.jsx(ae,{children:e.jsx(re,{children:"Profile"})}),e.jsx(ne,{children:e.jsx("ul",{className:"flex-col mt-4",children:t.map((h,v)=>e.jsxs("li",{className:"flex gap-1 items-center text-start mb-2 justify-between",children:[e.jsx("label",{className:"w-1/4",children:h.label}),e.jsx(M,{value:h.value,onChange:N=>{const D=t.map((b,C)=>C===v?{...b,value:N.target.value}:b);o(D)},disabled:h.label==="Email"||s,className:"w-3/4"})]},h.label))})}),e.jsxs(st,{className:"flex justify-between",children:[e.jsx(j,{variant:"link",onClick:()=>{a(!s)},disabled:!s,children:"Edit Profile"}),e.jsx(j,{onClick:g,disabled:f||s,variant:s?"outline":"default",children:"Update Profile"})]})]})})]})},Zt=({className:s,...a})=>e.jsx("div",{className:p("flex flex-col gap-6 m-2",s),...a,children:e.jsxs(se,{className:"min-h-svh",children:[e.jsx(ae,{children:e.jsx(re,{className:"text-2xl",children:"Organizer Dashboard"})}),e.jsx(ne,{children:e.jsx("div",{className:"flex min-h-full w-full justify-center px-0 sm:px-8",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs(gt,{defaultValue:"create-post",className:"w-full",children:[e.jsxs(pt,{className:"grid w-full grid-cols-3",children:[e.jsx(q,{value:"create-post",children:"Create Post"}),e.jsx(q,{value:"post",children:"Posts"}),e.jsx(q,{value:"profile",children:"Profile"})]}),e.jsx(W,{value:"create-post",className:"flex",children:e.jsx(Yt,{})}),e.jsx(W,{value:"post",children:e.jsx(Qt,{})}),e.jsx(W,{value:"profile",children:e.jsx(Xt,{})})]})})})})]})});function cs(){const s=fe(),[a,t]=x.useState(!0);return x.useEffect(()=>{const o=H.get("auth_token");o?o===void 0?s("/"):t(!1):s("/login")},[s]),a?e.jsx("div",{className:"flex min-h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-4"}),e.jsx("p",{children:"Loading..."})]})}):e.jsxs("div",{children:[e.jsx(at,{}),e.jsx(Zt,{}),e.jsx(kt,{})]})}export{cs as default};
